<div class="container" id="partial-container">
  <div class="row">
    <div class="col-xs-4" style="margin-top: 20px">
      <div class="movie-info">
        <div class="movie-poster">
          <%= image_tag "#{@movie.imdb_poster ? @movie.imdb_poster : @movie.poster }", class: "movie-poster"  %>
        </div>
        <div class="movie-title">
          <h1>
            <%= @movie.title  %>
          </h1>
          <p>
            <%= @movie.rating.to_f / 2 %> <i class="fa fa-star red-star" aria-hidden="true"> </i> out of <%= @movie.reviews.size %> reviews!
          </p>
        </div>

        <div class="movie-info-box">
          <%= @movie.plot  %>
          <br>
        </div>
      </div>
    </div>

    <div class="col-xs-8">
      <% if @review %>
      <div class= "card card-outline-primary mb-3 text-center">
        <div class= "card-header">
          <h3>
            <%= @review.title %>
          </h3>
        </div>
        <div class="card-block">
          <div class="card-text">
            <blockquote class="card-blockquote">
              <p>
                <%=raw @review.content %>
              </p>
              <footer>
                <cite>
                  <%= @review.rating.to_f / 2 %> <i class="fa fa-star" style="color: green;" aria-hidden="true"> </i>
                  <%= @review.created_at.strftime('%A, %d %b %Y %l:%M %p') %>
                  as reviewed by <%= @review.user.profile ? @review.user.profile.username : @review.user.email %>
                </cite>
              </footer>
            </blockquote>
          </div>
        </div>
        <% if @review.has_rated(@user) && @review_rating.rating %>
        <div>
          <p>
            You gave this review
            <%= @review_rating.rating.to_f / 2 %>
            <i class="fa fa-star" aria-hidden="true">  </i>
          </p>
          Users rate this review <%= @review.set_rating.to_f / 2 %> <i class="fa fa-star" aria-hidden="true">  </i>
        </div>
        <% elsif current_user %>
        <div class="row">
          <div class="card-rating center-block">
            <p> Rate this review</p>
            <%= render 'shared/star-rating' %>
          </div>
        </div>
        <% else %>
        <div class="row">
          <div class="card-rating center-block">
            <p> To share your rating of this review, please log in.</p>
          </div>
        </div>
        <% end %>
        <div class="card-btns">
          <% if current_user %>
          <% if policy(@review).update? %>
          <%= link_to ' - Edit review', edit_movie_review_path(@movie, @review), class: "btn vegan-btn fa fa-eraser"  %>
          <% end %>
          <% if policy(@review).destroy? %>
          <%= link_to ' - Delete', movie_review_path(@movie, @review), method: :delete, data: { confirm: 'Are you sure?' }, class: "fa fa-trash-o btn vegan-btn" %>
          <% end %>
          <%= link_to ' - Add a review', new_movie_review_path(@movie), class: "fa fa-pencil-square-o btn vegan-btn" %>
          <% end %>
          <%= link_to ' - More reviews', movie_path(@movie), class: "fa fa-comments-o btn vegan-btn" %>
        </div>
      </div>
    </div>

    <% unless @review.artwork.url.nil? || @review.artwork.url == ""  %>
      <div class="background-value" data-hidden="linear-gradient(27deg, rgba(255,243,191,1) 0%, rgba(255,243,191,0.7) 41%, rgba(  0,128,128,0.25) 100%), url(<%= @review.artwork.url %>)">
      </div>
    <% else %>
      <div class="background-value" data-hidden="">
      </div>
    <% end %>

    <% else %>

    <p style="padding: 100px;">
      No reviews yet! <br>
      Be the first to leave one <%= link_to 'Leave a review', new_movie_review_path(@movie), class: "btn vegan-btn"  %>
    </p>
    <% end %>
  </div>
</div>
